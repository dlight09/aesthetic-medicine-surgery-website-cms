---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { listPublicAvantApresCases, type AvantApresCaseView } from '@/lib/cms/avantApres';

Astro.response.headers.set('Cache-Control', 'no-store');
const cases = (await listPublicAvantApresCases()) as AvantApresCaseView[];
---

<BaseLayout title="Avant-Apres" description="Galerie Avant-Apres (lorsque disponible) avec consentement et mentions.">
  <section class="mx-auto max-w-6xl px-4 py-14">
    <h1 class="font-display text-4xl tracking-tight">Avant-Apres</h1>
    <p class="mt-4 max-w-3xl text-ink/75">
      Les resultats varient selon chaque patient. Les photos ne constituent pas une garantie de resultat.
      Toute publication se fait avec consentement.
    </p>

    {cases.length ? (
      <div class="mt-10 grid gap-6 sm:grid-cols-2">
        {cases.map((item: AvantApresCaseView) => (
          <a
            href={`/avant-apres/${item.id}`}
            class="group overflow-hidden rounded-3xl border border-ink/10 bg-paper shadow-soft transition hover:shadow-lift"
          >
            <div class="relative aspect-[4/3] w-full">
              <img src={item.afterUrl} alt="Apres" class="h-full w-full object-cover" loading="lazy" />
              <div class="pointer-events-none absolute inset-0 bg-[linear-gradient(to_top,rgba(20,20,19,0.55),transparent_55%)]"></div>
              <div class="absolute inset-x-0 bottom-0 p-5 text-paper">
                <div class="text-xs font-semibold uppercase tracking-wide text-paper/70">Avant / apres</div>
                <div class="mt-1 font-display text-2xl tracking-tight">{item.title}</div>
              </div>
            </div>
            <div class="p-6">
              <div class="text-sm text-ink/70">{item.zone ?? '—'}</div>
              <div class="mt-3 text-sm font-semibold text-ink/80 transition group-hover:text-ink">
                Voir le cas →
              </div>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="mt-10 rounded-3xl border border-ink/10 bg-mist p-10 text-ink/75">
        Galerie en cours de preparation.
      </div>
    )}
  </section>
</BaseLayout>
