---
import CmsLayout from '@/layouts/CmsLayout.astro';
import { cmsBlogPosts, cmsBookings } from '@/lib/cms/mock';
import { listCmsAvantApresCases } from '@/lib/cms/avantApres';

const latestBookings = cmsBookings.slice(0, 3);
const latestAvantApres = await listCmsAvantApresCases();
const latestContent = [
  { type: 'Avant/Après', title: latestAvantApres[0]?.title, href: `/cms/avant-apres/${latestAvantApres[0]?.id}` },
  { type: 'Blog', title: cmsBlogPosts[0]?.title, href: `/cms/blog/${cmsBlogPosts[0]?.slug}` }
].filter((x) => x.title);
---

<CmsLayout title="Tableau de bord">
  <div class="space-y-8">
    <section class="grid gap-4 sm:grid-cols-3">
      <div class="cms-card-elevated p-6">
        <div class="text-xs font-semibold uppercase tracking-wide text-ink/50">Nouvelles demandes</div>
        <div class="mt-3 font-display text-3xl">3</div>
        <div class="mt-2 text-sm text-ink/60">A traiter aujourd’hui</div>
      </div>
      <div class="cms-card-elevated p-6">
        <div class="text-xs font-semibold uppercase tracking-wide text-ink/50">Brouillons</div>
        <div class="mt-3 font-display text-3xl">2</div>
        <div class="mt-2 text-sm text-ink/60">Avant publication</div>
      </div>
      <div class="cms-card-elevated p-6">
        <div class="text-xs font-semibold uppercase tracking-wide text-ink/50">Avant/Après</div>
        <div class="mt-3 font-display text-3xl">{latestAvantApres.length}</div>
        <div class="mt-2 text-sm text-ink/60">Cas en suivi</div>
      </div>
    </section>

    <section class="grid gap-4 lg:grid-cols-3">
      <div class="cms-card p-6 lg:col-span-2">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xs font-semibold uppercase tracking-wide text-ink/50">Dernieres demandes</div>
            <div class="mt-2 font-display text-2xl tracking-tight">Bookings</div>
          </div>
          <a href="/cms/bookings" class="link text-sm">Tout voir →</a>
        </div>
        <div class="mt-6 space-y-3">
          {latestBookings.map((b) => (
            <a href={`/cms/bookings/${b.id}`} class="cms-row flex items-center justify-between rounded-2xl border border-ink/10 bg-mist px-4 py-3 text-sm">
              <div>
                <div class="font-semibold text-ink/90">{b.patientName}</div>
                <div class="text-ink/60">{b.category} • {b.channel}</div>
              </div>
              <div class="text-ink/60">{b.desiredDate}</div>
            </a>
          ))}
        </div>
      </div>

      <div class="cms-card p-6">
        <div class="text-xs font-semibold uppercase tracking-wide text-ink/50">Contenus recents</div>
        <div class="mt-2 font-display text-2xl tracking-tight">A publier</div>
        <div class="mt-6 space-y-3">
          {latestContent.length ? (
            latestContent.map((c) => (
              <a href={c.href} class="cms-row block rounded-2xl border border-ink/10 bg-mist px-4 py-3 text-sm">
                <div class="text-xs uppercase tracking-wide text-ink/50">{c.type}</div>
                <div class="mt-1 font-semibold text-ink/85">{c.title}</div>
              </a>
            ))
          ) : (
            <div class="text-sm text-ink/60">Aucun contenu en attente.</div>
          )}
        </div>
      </div>
    </section>
  </div>
</CmsLayout>
